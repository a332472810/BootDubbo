<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xescm.ofc.mapper.OfcTransplanInfoMapper" >
  <resultMap id="BaseResultMap" type="com.xescm.ofc.domain.OfcTransplanInfo" >
    <!--
      WARNING - @mbg.generated
    -->
    <id column="plan_code" property="planCode" jdbcType="VARCHAR" />
    <result column="order_code" property="orderCode" jdbcType="VARCHAR" />
    <result column="order_batch_number" property="orderBatchNumber" jdbcType="VARCHAR" />
    <result column="program_serial_number" property="programSerialNumber" jdbcType="VARCHAR" />
    <result column="business_type" property="businessType" jdbcType="VARCHAR" />
    <result column="order_time" property="orderTime" jdbcType="TIMESTAMP" />
    <result column="cust_code" property="custCode" jdbcType="VARCHAR" />
    <result column="pickup_time" property="pickupTime" jdbcType="TIMESTAMP" />
    <result column="expected_arrived_time" property="expectedArrivedTime" jdbcType="TIMESTAMP" />
    <result column="weight" property="weight" jdbcType="DECIMAL" />
    <result column="quantity" property="quantity" jdbcType="DECIMAL" />
    <result column="volume" property="volume" jdbcType="DECIMAL" />
    <result column="money" property="money" jdbcType="DECIMAL" />
    <result column="shippin_customer_code" property="shippinCustomerCode" jdbcType="VARCHAR" />
    <result column="shippin_customer_name" property="shippinCustomerName" jdbcType="VARCHAR" />
    <result column="shipping_address" property="shippingAddress" jdbcType="VARCHAR" />
    <result column="shipping_customer_contact" property="shippingCustomerContact" jdbcType="VARCHAR" />
    <result column="customer_contact_phone" property="customerContactPhone" jdbcType="VARCHAR" />
    <result column="departure_province" property="departureProvince" jdbcType="VARCHAR" />
    <result column="departure_city" property="departureCity" jdbcType="VARCHAR" />
    <result column="departure_district" property="departureDistrict" jdbcType="VARCHAR" />
    <result column="departure_towns" property="departureTowns" jdbcType="VARCHAR" />
    <result column="departure_place_code" jdbcType="VARCHAR" property="departurePlaceCode" />
    <result column="receiving_customer_code" property="receivingCustomerCode" jdbcType="VARCHAR" />
    <result column="receiving_customer_name" property="receivingCustomerName" jdbcType="VARCHAR" />
    <result column="receiving_customer_address" property="receivingCustomerAddress" jdbcType="VARCHAR" />
    <result column="receiving_customer_contact" property="receivingCustomerContact" jdbcType="VARCHAR" />
    <result column="receiving_customer_contact_phone" property="receivingCustomerContactPhone" jdbcType="VARCHAR" />
    <result column="destination_province" property="destinationProvince" jdbcType="VARCHAR" />
    <result column="destination_city" property="destinationCity" jdbcType="VARCHAR" />
    <result column="destination_district" property="destinationDistrict" jdbcType="VARCHAR" />
    <result column="destination_town" property="destinationTown" jdbcType="VARCHAR" />
    <result column="destination_code" jdbcType="VARCHAR" property="destinationCode" />
    <result column="receiving_address_longitude" property="receivingAddressLongitude" jdbcType="VARCHAR" />
    <result column="receiving_address_latitude" property="receivingAddressLatitude" jdbcType="VARCHAR" />
    <result column="notes" property="notes" jdbcType="VARCHAR" />
    <result column="sale_organization" property="saleOrganization" jdbcType="VARCHAR" />
    <result column="product_group" property="productGroup" jdbcType="VARCHAR" />
    <result column="sale_department" property="saleDepartment" jdbcType="VARCHAR" />
    <result column="sale_group" property="saleGroup" jdbcType="VARCHAR" />
    <result column="sale_department_desc" property="saleDepartmentDesc" jdbcType="VARCHAR" />
    <result column="sale_group_desc" property="saleGroupDesc" jdbcType="VARCHAR" />
    <result column="single_source_of_transport" property="singleSourceOfTransport" jdbcType="VARCHAR" />
    <result column="service_charge" property="serviceCharge" jdbcType="DECIMAL" />
    <result column="base_id" jdbcType="VARCHAR" property="baseId" />
    <result column="creation_time" property="creationTime" jdbcType="TIMESTAMP" />
    <result column="create_personnel" property="createPersonnel" jdbcType="VARCHAR" />
    <result column="void_personnel" property="voidPersonnel" jdbcType="VARCHAR" />
    <result column="void_time" property="voidTime" jdbcType="TIMESTAMP" />
    <result column="merchandiser" jdbcType="VARCHAR" property="merchandiser" />
    <result column="transport_type" jdbcType="VARCHAR" property="transportType" />
    <result column="base_name" jdbcType="VARCHAR" property="baseName" />
    <result column="goods_type" jdbcType="VARCHAR" property="goodsType" />
    <result column="goods_type_name" jdbcType="VARCHAR" property="goodsTypeName" />
    <result column="cust_name" jdbcType="VARCHAR" property="custName" />
    <result column="two_distribution" property="twoDistribution" jdbcType="VARCHAR" />
  </resultMap>

  <resultMap id="DpcTranPlanResultMap" type="com.xescm.ofc.edas.model.dto.dpc.resp.TranPlanOfcRespDTO" >
    <id column="plan_code" property="planCode" jdbcType="VARCHAR" />
    <result column="order_code" property="orderCode" jdbcType="VARCHAR" />
    <result column="order_type" property="orderType" jdbcType="VARCHAR" />
    <result column="cust_code" property="custCode" jdbcType="VARCHAR" />
    <result column="weight" property="weight" jdbcType="DECIMAL" />
    <result column="departure_province" property="departureProvince" jdbcType="VARCHAR" />
    <result column="departure_city" property="departureCity" jdbcType="VARCHAR" />
    <result column="departure_district" property="departureDistrict" jdbcType="VARCHAR" />
    <result column="departure_towns" property="departureTowns" jdbcType="VARCHAR" />
    <result column="destination_province" property="destinationProvince" jdbcType="VARCHAR" />
    <result column="destination_city" property="destinationCity" jdbcType="VARCHAR" />
    <result column="destination_district" property="destinationDistrict" jdbcType="VARCHAR" />
    <result column="destination_town" property="destinationTown" jdbcType="VARCHAR" />
    <result column="creation_time" property="creationTime" jdbcType="TIMESTAMP" />
    <result column="transport_type" jdbcType="VARCHAR" property="transportType" />
    <result column="goods_type" jdbcType="VARCHAR" property="goodsType" />
    <result column="goods_type_name" jdbcType="VARCHAR" property="goodsTypeName" />
    <result column="cust_name" jdbcType="VARCHAR" property="custName" />
    <result column="plate_number" property="plateNumber" jdbcType="VARCHAR" />
    <result column="cust_order_code" property="custOrderCode" jdbcType="VARCHAR" />
    <result column="scheduling_state" property="schedulingState" jdbcType="VARCHAR" />
  </resultMap>

  <resultMap id="ofcTransplanInfoVoResultMap" type="com.xescm.ofc.model.vo.ofc.OfcTransplanInfoVo" >
    <!--
      WARNING - @mbg.generated
    -->
    <id column="plan_code" property="planCode" jdbcType="VARCHAR" />
    <result column="order_code" property="orderCode" jdbcType="VARCHAR" />
    <result column="order_batch_number" property="orderBatchNumber" jdbcType="VARCHAR" />
    <result column="program_serial_number" property="programSerialNumber" jdbcType="VARCHAR" />
    <result column="business_type" property="businessType" jdbcType="VARCHAR" />
    <result column="order_time" property="orderTime" jdbcType="TIMESTAMP" />
    <result column="cust_code" property="custCode" jdbcType="VARCHAR" />
    <result column="pickup_time" property="pickupTime" jdbcType="TIMESTAMP" />
    <result column="expected_arrived_time" property="expectedArrivedTime" jdbcType="TIMESTAMP" />
    <result column="weight" property="weight" jdbcType="DECIMAL" />
    <result column="quantity" property="quantity" jdbcType="DECIMAL" />
    <result column="volume" property="volume" jdbcType="DECIMAL" />
    <result column="money" property="money" jdbcType="DECIMAL" />
    <result column="shippin_customer_code" property="shippinCustomerCode" jdbcType="VARCHAR" />
    <result column="shippin_customer_name" property="shippinCustomerName" jdbcType="VARCHAR" />
    <result column="shipping_address" property="shippingAddress" jdbcType="VARCHAR" />
    <result column="shipping_customer_contact" property="shippingCustomerContact" jdbcType="VARCHAR" />
    <result column="customer_contact_phone" property="customerContactPhone" jdbcType="VARCHAR" />
    <result column="departure_province" property="departureProvince" jdbcType="VARCHAR" />
    <result column="departure_city" property="departureCity" jdbcType="VARCHAR" />
    <result column="departure_district" property="departureDistrict" jdbcType="VARCHAR" />
    <result column="departure_towns" property="departureTowns" jdbcType="VARCHAR" />
    <result column="departure_place_code" jdbcType="VARCHAR" property="departurePlaceCode" />
    <result column="receiving_customer_code" property="receivingCustomerCode" jdbcType="VARCHAR" />
    <result column="receiving_customer_name" property="receivingCustomerName" jdbcType="VARCHAR" />
    <result column="receiving_customer_address" property="receivingCustomerAddress" jdbcType="VARCHAR" />
    <result column="receiving_customer_contact" property="receivingCustomerContact" jdbcType="VARCHAR" />
    <result column="receiving_customer_contact_phone" property="receivingCustomerContactPhone" jdbcType="VARCHAR" />
    <result column="destination_province" property="destinationProvince" jdbcType="VARCHAR" />
    <result column="destination_city" property="destinationCity" jdbcType="VARCHAR" />
    <result column="destination_district" property="destinationDistrict" jdbcType="VARCHAR" />
    <result column="destination_town" property="destinationTown" jdbcType="VARCHAR" />
    <result column="destination_code" jdbcType="VARCHAR" property="destinationCode" />
    <result column="receiving_address_longitude" property="receivingAddressLongitude" jdbcType="VARCHAR" />
    <result column="receiving_address_latitude" property="receivingAddressLatitude" jdbcType="VARCHAR" />
    <result column="notes" property="notes" jdbcType="VARCHAR" />
    <result column="sale_organization" property="saleOrganization" jdbcType="VARCHAR" />
    <result column="product_group" property="productGroup" jdbcType="VARCHAR" />
    <result column="sale_department" property="saleDepartment" jdbcType="VARCHAR" />
    <result column="sale_group" property="saleGroup" jdbcType="VARCHAR" />
    <result column="sale_department_desc" property="saleDepartmentDesc" jdbcType="VARCHAR" />
    <result column="sale_group_desc" property="saleGroupDesc" jdbcType="VARCHAR" />
    <result column="single_source_of_transport" property="singleSourceOfTransport" jdbcType="VARCHAR" />
    <result column="service_charge" property="serviceCharge" jdbcType="DECIMAL" />
    <result column="base_id" jdbcType="VARCHAR" property="baseId" />
    <result column="creation_time" property="creationTime" jdbcType="TIMESTAMP" />
    <result column="create_personnel" property="createPersonnel" jdbcType="VARCHAR" />
    <result column="void_personnel" property="voidPersonnel" jdbcType="VARCHAR" />
    <result column="void_time" property="voidTime" jdbcType="TIMESTAMP" />
    <result column="merchandiser" jdbcType="VARCHAR" property="merchandiser" />
    <result column="transport_type" jdbcType="VARCHAR" property="transportType" />
    <result column="transport_type" jdbcType="VARCHAR" property="transportType" />
    <result column="planned_single_state" property="plannedSingleState" jdbcType="VARCHAR" />
  </resultMap>

  <!--非作废运输计划单列表查询-->
  <select id="ofcTransplanInfoScreenList" parameterType="java.lang.String" resultMap="BaseResultMap">
    SELECT
    otp.plan_code,
    otp.order_code,
    otp.order_batch_number,
    otp.program_serial_number,
    otp.business_type,
    otp.order_time,
    otp.cust_code,
    otp.pickup_time,
    otp.expected_arrived_time,
    otp.weight,
    otp.quantity,
    otp.volume,
    otp.money,
    otp.shippin_customer_code,
    otp.shippin_customer_name,
    otp.shipping_address,
    otp.shipping_customer_contact,
    otp.customer_contact_phone,
    otp.departure_province,
    otp.departure_city,
    otp.departure_district,
    otp.departure_towns,
    otp.departure_place_code,
    otp.receiving_customer_code,
    otp.receiving_customer_name,
    otp.receiving_customer_address,
    otp.receiving_customer_contact,
    otp.receiving_customer_contact_phone,
    otp.destination_province,
    otp.destination_city,
    otp.destination_district,
    otp.destination_town,
    otp.destination_code,
    otp.receiving_address_longitude,
    otp.receiving_address_latitude,
    otp.notes,
    otp.sale_organization,
    otp.product_group,
    otp.sale_department,
    otp.sale_group,
    otp.sale_department_desc,
    otp.sale_group_desc,
    otp.single_source_of_transport,
    otp.service_charge,
    otp.base_id,
    otp.creation_time,
    otp.create_personnel,
    otp.void_personnel,
    otp.void_time,
    otp.merchandiser,
    otp.transport_type,
    otp.base_name,
    otp.goods_type,
    otp.goods_type_name,
    otp.cust_name,
    otp.two_distribution
    FROM
    ofc_transplan_info otp
    LEFT JOIN ofc_transplan_status ots ON otp.plan_code = ots.plan_code
    <where>
      <if test="orderCode!=null and orderCode!=''">
        otp.order_code =#{orderCode}
      </if>
      AND ots.planned_single_state <![CDATA[ <> ]]> '50'
      <if test="ifFinished!=null and ifFinished!=''">
        AND ots.planned_single_state <![CDATA[ <> ]]>  '40'
      </if>
    </where>
  </select>




  <select id="ofcTransplanInfoVoList" parameterType="java.lang.String" resultMap="ofcTransplanInfoVoResultMap">
    SELECT
    tinfo.*,
    ots.planned_single_state
    FROM
    ofc_transplan_info tinfo
    LEFT JOIN ofc_transplan_status ots ON tinfo.plan_code = ots.plan_code
    <where>
        1 = 1
      <if test="planCode!=null and planCode!=''">
        AND  tinfo.plan_code =#{planCode}
      </if>
    </where>
  </select>


 <select id="queryNotInvalidAndNotCompleteTransOrder" parameterType="java.lang.String" resultType="int">
  SELECT
  COUNT(oti.order_code)
  FROM
  ofc_transplan_info oti
  LEFT JOIN ofc_transplan_status ots ON oti.plan_code = ots.plan_code
  <where>
    <if test="orderCode != null and orderCode != ''">
      AND oti.order_code = #{orderCode,jdbcType=VARCHAR}
    </if>
    AND ots.planned_single_state <![CDATA[ <> ]]> '50'
    AND ots.planned_single_state <![CDATA[ <> ]]> '40'
  </where>

 </select>

  <select id="queryTransCodeByOrderCode" parameterType="java.lang.String" resultType="java.lang.String">
    SELECT
    oti.plan_code
    FROM
    ofc_transplan_info oti
    LEFT JOIN ofc_transplan_status ots ON oti.plan_code = ots.plan_code
    <where>
      <if test="orderCode != null and orderCode != '' ">
        AND oti.order_code  = #{orderCode,jdbcType=VARCHAR}
      </if>
      AND ots.planned_single_state <![CDATA[ <> ]]> '50'
    </where>
  </select>

  <select id="queryUncompletedPlanCodesByOrderCode" parameterType="java.lang.String" resultType="java.lang.String">
    SELECT
    oti.plan_code
    FROM
    ofc_transplan_info oti
    LEFT JOIN ofc_transplan_status ots ON oti.plan_code = ots.plan_code
    <where>
      <if test="orderCode != null and orderCode != '' ">
        AND oti.order_code  = #{orderCode,jdbcType=VARCHAR}
      </if>
      AND ots.planned_single_state <![CDATA[ <> ]]> '50'
      AND ots.planned_single_state <![CDATA[ <> ]]> '40'
    </where>
  </select>

  <!--调度中心计划单列表查询-->
  <select id="tranPlanSel" parameterType="com.xescm.ofc.edas.model.dto.dpc.req.TranPlanOfcReqDTO" resultMap="DpcTranPlanResultMap">
    SELECT DISTINCT
    oti.plan_code,
    oti.order_code,
    ofi.cust_order_code,
    ofi.order_type,
    oti.scheduling_state,
    otss.plate_number,
    oti.cust_code,
    oti.cust_name,
    oti.departure_province,
    oti.departure_city,
    oti.departure_district,
    oti.departure_towns,
    oti.destination_province,
    oti.destination_city,
    oti.destination_district,
    oti.destination_town,
    oti.goods_type,
    oti.goods_type_name,
    oti.transport_type,
    oti.weight,
    oti.transport_pool,
    oti.matching_mode
    FROM
    ofc_transplan_info oti
    LEFT JOIN ofc_fundamental_information ofi ON oti.order_code = ofi.order_code
    LEFT JOIN ofc_traplan_source_status otss ON oti.plan_code = otss.plan_code
    <where>
      <if test="orderTimeStart!=null and orderTimeStart!=''">
        oti.creation_time <![CDATA[ >= ]]> #{orderTimeStart}
      </if>
      <if test="orderTimeEnd!=null and orderTimeEnd!=''">
        AND oti.creation_time <![CDATA[ <= ]]> #{orderTimeEnd}
      </if>
      <if test="resourceAllocationStatus!=null and resourceAllocationStatus!=''">
        AND otss.resource_allocation_status = #{resourceAllocationStatus}
      </if>
      <if test="TransportPool!=null and TransportPool!=''">
        AND otss.transport_pool = #{TransportPool}
      </if>
      <if test="custCode!=null and custCode!=''">
        AND otss.cust_code = #{custCode}
      </if>
      <if test="custName!=null and custName!=''">
        AND otss.cust_name = #{custName}
      </if>
      <if test="departureProvince!=null and departureProvince!=''">
        AND otss.departure_province = #{departureProvince}
      </if>
      <if test="departureCity!=null and departureCity!=''">
        AND otss.departure_city = #{departureCity}
      </if>
      <if test="departureDistrict!=null and departureDistrict!=''">
        AND otss.departure_district = #{departureDistrict}
      </if>
      <if test="departureTowns!=null and departureTowns!=''">
        AND otss.departure_towns = #{departureTowns}
      </if>
      <if test="destinationProvince!=null and destinationProvince!=''">
        AND otss.destination_province = #{destinationProvince}
      </if>
      <if test="destinationCity!=null and destinationCity!=''">
        AND otss.destination_city = #{destinationCity}
      </if>
      <if test="destinationDistrict!=null and destinationDistrict!=''">
        AND otss.destination_district = #{destinationDistrict}
      </if>
      <if test="destinationTown!=null and destinationTown!=''">
        AND otss.destination_town = #{destinationTown}
      </if>
    </where>
    ORDER BY
      plan_code DESC
  </select>
</mapper>