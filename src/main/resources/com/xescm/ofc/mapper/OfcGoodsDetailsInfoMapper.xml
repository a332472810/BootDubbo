<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xescm.ofc.mapper.OfcGoodsDetailsInfoMapper" >
  <resultMap id="BaseResultMap" type="com.xescm.ofc.domain.OfcGoodsDetailsInfo" >
    <!--
      WARNING - @mbg.generated
    -->
    <result column="goods_code" property="goodsCode" jdbcType="VARCHAR" />
    <result column="goods_name" property="goodsName" jdbcType="VARCHAR" />
    <result column="goods_spec" property="goodsSpec" jdbcType="VARCHAR" />
    <result column="unit" property="unit" jdbcType="VARCHAR" />
    <result column="quantity" property="quantity" jdbcType="DECIMAL" />
    <result column="unit_price" property="unitPrice" jdbcType="DECIMAL" />
    <result column="production_batch" property="productionBatch" jdbcType="VARCHAR" />
    <result column="production_time" property="productionTime" jdbcType="TIMESTAMP" />
    <result column="invalid_time" property="invalidTime" jdbcType="TIMESTAMP" />
    <result column="order_code" property="orderCode" jdbcType="VARCHAR" />
    <result column="notes" property="notes" jdbcType="VARCHAR" />
    <result column="creation_time" property="creationTime" jdbcType="TIMESTAMP" />
    <result column="creator" property="creator" jdbcType="VARCHAR" />
    <result column="operator" property="operator" jdbcType="VARCHAR" />
    <result column="oper_time" property="operTime" jdbcType="TIMESTAMP" />
    <result column="weight" property="weight" jdbcType="DECIMAL" />
    <result column="cubage" property="cubage" jdbcType="DECIMAL" />
    <result column="total_box" property="totalBox" jdbcType="INTEGER" />
    <result column="goods_category" property="goodsCategory" jdbcType="VARCHAR" />
    <result column="pack" property="pack" jdbcType="VARCHAR" />
    <result column="quantity_unit_price" property="quantityUnitPrice" jdbcType="DECIMAL" />
    <result column="weight_unit_price" property="weightUnitPrice" jdbcType="DECIMAL" />
    <result column="volume_unit_price" property="volumeUnitPrice" jdbcType="DECIMAL" />
  </resultMap>

  <!--订单货品列表查询-->
  <select id="goodsDetailsScreen" parameterType="java.lang.String" resultMap="BaseResultMap">
    SELECT
    oos.*
    FROM
    ofc_goods_details_info oos
    LEFT JOIN ofc_fundamental_information ofi ON oos.order_code = ofi.order_code
    <where>
      <if test="orderCode!=null and orderCode!=''">
        oos.order_code =#{orderCode}
      </if>
    </where>
  </select>

  <delete id="deleteByOrderCode" parameterType="java.lang.String" >
    <!--
      根据订单编号和货品编号进行删除
    -->
    delete from ofc_goods_details_info
    where order_code = #{orderCode,jdbcType=VARCHAR} AND goods_code = #{goodsCode,jdbcType=VARCHAR}
  </delete>

  <delete id="deleteAllByOrderCode" >
    <!-- 根据订单编号进行删除所有符合条件的数据 -->
    delete from ofc_goods_details_info
    where order_code = #{orderCode,jdbcType=VARCHAR}
  </delete>

  <select id="queryByOrderCode" resultMap="BaseResultMap">
    SELECT gdi.*
    FROM ofc_goods_details_info gdi
    LEFT JOIN
    ofc_fundamental_information ofi
    ON ofi.order_code = gdi.order_code
    WHERE
     gdi.order_code = #{orderCode}
  </select>

  <!-- 批量插入订单明细表主键id -->
  <insert id="batchInsertGoodsDetail" parameterType="java.util.List">

    INSERT INTO ofc_goods_details_info_copy (id, goods_code, goods_name, goods_spec, unit, quantity, unit_price, production_batch,
    production_time, invalid_time, order_code, notes, creation_time, creator, operator, oper_time, weight, cubage, total_box,
    goods_category, pack, quantity_unit_price, weight_unit_price, volume_unit_price, billing_weight, goods_type, charging_ways,
    charging_quantity, charging_unit_price)
    VALUES
    <foreach collection="details" item="detail" index="index" open="" close="" separator=",">
      (#{detail.id}, #{detail.goodsCode}, #{detail.goodsName}, #{detail.goodsSpec}, #{detail.unit}, #{detail.quantity},
      #{detail.unitPrice}, #{detail.productionBatch}, #{detail.productionTime}, #{detail.invalidTime}, #{detail.orderCode},
      #{detail.notes}, #{detail.creationTime}, #{detail.creator}, #{detail.operator}, #{detail.operTime}, #{detail.weight},
      #{detail.cubage}, #{detail.totalBox}, #{detail.goodsCategory}, #{detail.pack}, #{detail.quantityUnitPrice}, #{detail.weightUnitPrice},
      #{detail.volumeUnitPrice}, #{detail.billingWeight}, #{detail.goodsType}, #{detail.chargingWays}, #{detail.chargingQuantity},
      #{detail.chargingUnitPrice})
    </foreach>
  </insert>
</mapper>